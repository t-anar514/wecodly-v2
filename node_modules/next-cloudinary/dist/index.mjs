import he,{useState as Oe,useCallback as Ue,forwardRef as Ee}from"react";import Pe from"next/image";import{pollForProcessingImage as ae}from"@cloudinary-util/util";import{transformationPlugins as we}from"@cloudinary-util/url-loader";import{constructCloudinaryUrl as Ie}from"@cloudinary-util/url-loader";import Ce from"next/package.json";var te={name:"next-cloudinary",version:"6.16.0",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var oe="A",re="V",ne=de(Ce.version),ie=de(te.version);function de(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function A(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let l=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,a=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:l,cloudName:t},url:{...e?.url,secureDistribution:a,privateCdn:o}},e)}function R(e){return Object.assign({product:oe,sdkCode:re,sdkSemver:ie,techVersion:ne,feature:""},e)}function L(e,t,l){return Ie({options:e,config:A(t),analytics:R(l)})}function z({loaderOptions:e,imageProps:t,cldOptions:l,cldConfig:a={}}){let o={...t,...l};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let r=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*r))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return L(o,a)}var Ae=Ee(function(t,l){let a=!1,o=["assetType","config","deliveryType","strictTransformations"];we.forEach(({props:n})=>{Object.keys(n).forEach(y=>{if(o.includes(y))throw new Error(`Option ${y} already exists!`);o.push(y)})});let r={alt:t.alt,src:t.src};Object.keys(t).filter(n=>typeof n=="string"&&!o.includes(n)).forEach(n=>r[n]=t[n]);let p=Object.keys(r).map(n=>`${n}:${r[n]}`).join(";"),[C,f]=Oe(p),d={};o.forEach(n=>{let m=t[n];m&&(d[n]=m)});let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(r.src=L({...d,width:r.width,height:r.height,src:r.src,format:"default",quality:"default"},t.config));async function P(n){let m=!0;if(a)return;if(a=!0,typeof t.onError=="function"){let I=t.onError(n);typeof I=="boolean"&&I===!1&&(m=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(m=!1);if(m===!1)return;let y=n.target,O=await ae({src:y.src});typeof O.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${O.error}`),O.success&&f(`${p};${Date.now()}`)}let _=Ue(P,[ae,p]),u=Pe;return"default"in u&&(u=u.default),he.createElement(u,{key:C,...r,loader:n=>z({loaderOptions:n,imageProps:r,cldOptions:d,cldConfig:t.config}),onError:_,ref:l})}),le=Ae;import E from"react";import _e from"next/head";function $(e){return L({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var xe="summary_large_image",Le=({excludeTags:e=[],twitterTitle:t,keys:l={},...a})=>{let{alt:o}=a,{width:r=1200,height:p=627}=a;r=typeof r=="string"?parseInt(r):r,p=typeof p=="string"?parseInt(p):p;let C=$({...a,width:r,height:p}),f=$({...a,width:r,height:p,format:a.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...l};return E.createElement(_e,null,E.createElement("meta",{key:d["og:image"],property:"og:image",content:C}),E.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:C}),E.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${r}`}),E.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${p}`}),o&&E.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&E.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),E.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:xe}),E.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:f}))},se=Le;import B from"react";import Q,{useState as J,useEffect as ce,useRef as ue}from"react";import ve from"next/script";import{generateSignatureCallback as Te,generateUploadWidgetResultCallback as be,getUploadWidgetOptions as Ne,UPLOAD_WIDGET_EVENTS as We}from"@cloudinary-util/url-loader";function pe(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Me=({children:e,config:t,onError:l,onOpen:a,onUpload:o,options:r,signatureEndpoint:p,uploadPreset:C,...f})=>{let d=ue(),s=ue(),[P,_]=J(void 0),[u,n]=J(void 0),[m,y]=J(!0),O=A(t),I=p&&Te({signatureEndpoint:String(p),fetch}),b=Ne({uploadPreset:C||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:I,...r},O),w=be({onError:i=>{_(i),typeof l=="function"&&l(i,{widget:s.current,...D})},onResult:i=>{if(typeof i?.event!="string")return;n(i);let h=We[i.event];if(typeof h=="string"&&typeof f[h]=="function"){let V=f[h];V(i,{widget:s.current,...D})}let S=`${h}Action`;if(S&&typeof f[S]=="function"){let V=f[S];V(i)}}});ce(()=>{if(typeof u>"u")return;u.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(u,s.current))},[u]);function U(){y(!1),d.current||(d.current=window.cloudinary),pe(()=>{s.current||(s.current=G())})}ce(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function c(i,h=[]){if(s.current||(s.current=G()),typeof s?.current[i]=="function")return s.current[i](...h)}function k(i){c("close",[i])}function x(i){return c("destroy",[i])}function N(){c("hide")}function W(){return c("isDestroyed")}function M(){return c("isMinimized")}function g(){return c("isShowing")}function T(){c("minimize")}function H(i,h){c("open",[i,h]),typeof a=="function"&&a(s.current)}function X(){c("show")}function F(){c("update")}let D={close:k,destroy:x,hide:N,isDestroyed:W,isMinimized:M,isShowing:g,minimize:T,open:H,show:X,update:F};function G(){return d.current?.createUploadWidget(b,w)}return Q.createElement(Q.Fragment,null,typeof e=="function"&&e({cloudinary:d.current,widget:s.current,results:u,error:P,isLoading:m,...D}),Q.createElement(ve,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:U,onError:i=>console.error(`Failed to load Cloudinary Upload Widget: ${i.message}`)}))},j=Me;var De=({className:e,children:t,onClick:l,onError:a,onOpen:o,onUpload:r,onAbort:p,onBatchCancelled:C,onClose:f,onDisplayChanged:d,onPublicId:s,onQueuesEnd:P,onQueuesStart:_,onRetry:u,onShowCompleted:n,onSourceChanged:m,onSuccess:y,onTags:O,onUploadAdded:I,options:b,signatureEndpoint:w,uploadPreset:U,onAbortAction:c,onBatchCancelledAction:k,onCloseAction:x,onDisplayChangedAction:N,onPublicIdAction:W,onQueuesEndAction:M,onQueuesStartAction:g,onRetryAction:T,onShowCompletedAction:H,onSourceChangedAction:X,onSuccessAction:F,onTagsAction:D,onUploadAddedAction:G,...i})=>B.createElement(B.Fragment,null,B.createElement(j,{onError:a,onOpen:o,onUpload:r,onAbort:p,onBatchCancelled:C,onClose:f,onDisplayChanged:d,onPublicId:s,onQueuesEnd:P,onQueuesStart:_,onRetry:u,onShowCompleted:n,onSourceChanged:m,onSuccess:y,onTags:O,onUploadAdded:I,options:b,signatureEndpoint:w,uploadPreset:U,onAbortAction:c,onBatchCancelledAction:k,onCloseAction:x,onDisplayChangedAction:N,onPublicIdAction:W,onQueuesEndAction:M,onQueuesStartAction:g,onRetryAction:T,onShowCompletedAction:H,onSourceChangedAction:X,onSuccessAction:F,onTagsAction:D,onUploadAddedAction:G},({open:h,isLoading:S})=>{function V(ee){ee.preventDefault(),h(),typeof l=="function"&&l(ee)}return B.createElement("button",{...i,className:e||"",onClick:V,disabled:S},t||"Upload")})),ge=De;import v,{useRef as Z,useEffect as Se,useId as Ve}from"react";import ke from"next/script";import Ge from"next/head";import{getVideoPlayerOptions as Re}from"@cloudinary-util/url-loader";var Y=[],me="1.11.1",$e=e=>{let{className:t,config:l,height:a,id:o,onDataLoad:r,onError:p,onMetadataLoad:C,onPause:f,onPlay:d,onEnded:s,width:P}=e,_=Ve(),u=A(l),n=Re(e,u),{publicId:m}=n;if(typeof m>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let y=Z(),O=Z(),I=e.videoRef||O,b=Z(),w=e.playerRef||b,U=o||`player-${_.replace(/:/g,"")}`,c="cld-video-player cld-fluid";t&&(c=`${c} ${t}`),Y.filter(g=>g===U).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work.
    Try adding a unique id to each player.`):Y.push(U);let x={error:p,loadeddata:r,loadedmetadata:C,pause:f,play:d,ended:s};function N(g){let T=x[g.type];typeof T=="function"&&T(M())}function W(){"cloudinary"in window&&(y.current=window.cloudinary,w.current=y.current.videoPlayer(I.current,n),Object.keys(x).forEach(g=>{typeof x[g]=="function"&&w.current?.on(g,N)}))}Se(()=>()=>{w.current?.videojs.cloudinary.dispose(),Y=Y.filter(g=>g!==U)},[]);function M(){return{player:w.current,video:I.current}}return v.createElement(v.Fragment,null,v.createElement(Ge,null,v.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${me}/dist/cld-video-player.min.css`,rel:"stylesheet"})),v.createElement("div",{style:{width:"100%",aspectRatio:`${P} / ${a}`}},v.createElement("video",{ref:I,id:U,className:c,width:P,height:a}),v.createElement(ke,{id:`cloudinary-videoplayer-${U}`,src:`https://unpkg.com/cloudinary-video-player@${me}/dist/cld-video-player.min.js`,onLoad:W,onError:g=>console.error(`Failed to load Cloudinary Video Player: ${g.message}`)})))},fe=$e;import{constructCloudinaryUrl as je}from"@cloudinary-util/url-loader";function Be(e,t,l){return je({options:{assetType:"video",format:"auto:video",...e},config:A(t),analytics:R(l)})}export{le as CldImage,se as CldOgImage,ge as CldUploadButton,j as CldUploadWidget,fe as CldVideoPlayer,z as cloudinaryLoader,L as getCldImageUrl,$ as getCldOgImageUrl,Be as getCldVideoUrl};
//# sourceMappingURL=index.mjs.map